import{a as l}from"./chunk-XSF6HTAU.js";import{b as p,e as v,f as w,i as S,j as E,l as I,q as h,r as f,v as b}from"./chunk-JSLBC6HI.js";import{c as g}from"./chunk-JVB3KVD6.js";import{R as m,V as c}from"./chunk-WL3GAS2Y.js";import{i as u}from"./chunk-VBFW7A5V.js";var D=(()=>{let o=class o{constructor(r,a,s,i,n){this.storageService=r,this.auth=a,this.userService=s,this.router=i,this.firestore=n,this.isAuthenticated=!1,this.STORAGE_KEY="auth_token"}loginWithGoogle(){return u(this,null,function*(){try{let r=new v,s=(yield E(this.auth,r)).user;if(s){let i=h(this.firestore,`usuarios/${s.uid}`),n=yield f(i),e;n.exists()?e=n.data():e={uid:s.uid,nombre:s.displayName||s.email||"Google User",email:s.email||"",role:void 0,onboarded:!1},e.role||(e.entrenadorId?e.role=l.ENTRENADOR:e.gimnasioId?e.role=l.GIMNASIO:e.role?e.role=e.role[0]:e.role=l.CLIENTE);let t=yield s.getIdToken();return yield this.userService.setUser(e),yield this.storageService.set(this.STORAGE_KEY,t),this.isAuthenticated=!0,this.redirectByRole(),!0}return!1}catch(r){throw r}})}login(r,a){return u(this,null,function*(){let i=(yield S(this.auth,r,a)).user;if(i){let n=h(this.firestore,`usuarios/${i.uid}`),e=yield f(n),t;e.exists()?t=e.data():t={uid:i.uid,nombre:i.displayName||i.email||"Usuario",email:i.email||"",role:void 0,onboarded:!1},t.role||(t.entrenadorId?t.role=l.ENTRENADOR:t.gimnasioId?t.role=l.GIMNASIO:t.role&&(t.role=t.role[0]));let R=yield i.getIdToken();yield this.userService.setUser(t),yield this.storageService.set(this.STORAGE_KEY,R),this.isAuthenticated=!0,this.redirectByRole()}})}redirectByRole(){switch(this.userService.getCurrentUser()?.role){case"gimnasio":this.router.navigate(["/gimnasio-tabs"]);break;case"entrenador":this.router.navigate(["/entrenador-tabs"]);break;case"cliente":this.router.navigate(["/cliente-tabs"]);break;default:this.router.navigate(["/cliente-tabs"])}}logout(){return u(this,null,function*(){this.isAuthenticated=!1,yield this.userService.clearUser();try{yield this.storageService.remove(this.STORAGE_KEY)}catch(r){console.error("Error al eliminar el token del storage",r)}})}};o.\u0275fac=function(a){return new(a||o)(c(p),c(w),c(b),c(g),c(I))},o.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();export{D as a};
