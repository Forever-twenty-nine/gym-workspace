import{k as g,l as I,n as L,o as h,p as C,q as r,t as f,u as O}from"./chunk-JSLBC6HI.js";import{R as u,W as m,ia as d}from"./chunk-WL3GAS2Y.js";import{a as o,b as a,i as l}from"./chunk-VBFW7A5V.js";var F=(()=>{let n=class n{constructor(){this.COLLECTION="clientes",this.firestore=m(I),this._clientes=d([]),this.clienteSignals=new Map,this.isListenerInitialized=!1,this.initializeListener()}initializeListener(){if(!this.isListenerInitialized)try{let e=h(this.firestore,this.COLLECTION);f(e,t=>{let s=t.docs.map(i=>this.mapFromFirestore(a(o({},i.data()),{id:i.id})));this._clientes.set(s)}),this.isListenerInitialized=!0}catch(e){console.warn("Error inicializando listener de clientes:",e)}}guardarCliente(e){return l(this,null,function*(){let t=h(this.firestore,this.COLLECTION),s=a(o({},e),{fechaRegistro:e.fechaRegistro?g.fromDate(e.fechaRegistro):void 0});if(e.id){let i=r(this.firestore,`${this.COLLECTION}/${e.id}`);yield O(i,s,{merge:!0});return}yield L(t,s)})}obtenerClientes(){return this._clientes.asReadonly()}obtenerClientePorId(e){if(!this.clienteSignals.has(e)){let t=d(null);this.clienteSignals.set(e,t);try{let s=r(this.firestore,`${this.COLLECTION}/${e}`);f(s,i=>{i.exists()?t.set(this.mapFromFirestore(a(o({},i.data()),{id:i.id}))):t.set(null)})}catch(s){console.warn(`Error obteniendo cliente ${e}:`,s),t.set(null)}}return this.clienteSignals.get(e).asReadonly()}eliminarCliente(e){return l(this,null,function*(){let t=r(this.firestore,`${this.COLLECTION}/${e}`);yield C(t)})}mapFromFirestore(e){let t=e.fechaRegistro&&e.fechaRegistro.toDate?e.fechaRegistro.toDate():e.fechaRegistro;return{id:e.id,gimnasioId:e.gimnasioId,activo:e.activo,fechaRegistro:t,objetivo:e.objetivo,rutinas:e.rutinas}}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();var v=(()=>{let n=class n{constructor(){this.COLLECTION="rutinas",this.firestore=m(I),this._rutinas=d([]),this.rutinaSignals=new Map,this.isListenerInitialized=!1,this.initializeListener()}initializeListener(){if(!this.isListenerInitialized)try{let e=h(this.firestore,this.COLLECTION);f(e,t=>{let s=t.docs.map(i=>this.mapFromFirestore(a(o({},i.data()),{id:i.id})));this._rutinas.set(s)}),this.isListenerInitialized=!0}catch(e){console.warn("Error inicializando listener de rutinas:",e)}}guardarRutina(e){return l(this,null,function*(){let t=h(this.firestore,this.COLLECTION),s=this.cleanUndefinedFields(a(o({},e),{fechaAsignacion:e.fechaAsignacion?g.fromDate(e.fechaAsignacion):void 0}));if(e.id){let i=r(this.firestore,`${this.COLLECTION}/${e.id}`);yield O(i,s,{merge:!0});return}yield L(t,s)})}obtenerRutinas(){return this._rutinas.asReadonly()}obtenerRutinaPorId(e){if(!this.rutinaSignals.has(e)){let t=d(null);this.rutinaSignals.set(e,t);try{let s=r(this.firestore,`${this.COLLECTION}/${e}`);f(s,i=>{i.exists()?t.set(this.mapFromFirestore(a(o({},i.data()),{id:i.id}))):t.set(null)})}catch(s){console.warn(`Error obteniendo rutina ${e}:`,s),t.set(null)}}return this.rutinaSignals.get(e).asReadonly()}eliminarRutina(e){return l(this,null,function*(){let t=r(this.firestore,`${this.COLLECTION}/${e}`);yield C(t)})}cleanUndefinedFields(e){let t={};for(let[s,i]of Object.entries(e))i!==void 0&&(t[s]=i);return t}mapFromFirestore(e){let t=e.fechaAsignacion&&e.fechaAsignacion.toDate?e.fechaAsignacion.toDate():e.fechaAsignacion;return{id:e.id,clienteId:e.clienteId,nombre:e.nombre,fechaAsignacion:t,ejercicios:e.ejercicios,activa:e.activa,entrenadorId:e.entrenadorId,gimnasioId:e.gimnasioId,duracion:e.duracion,DiasSemana:e.DiasSemana,completado:e.completado,notas:e.notas}}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();export{F as a,v as b};
