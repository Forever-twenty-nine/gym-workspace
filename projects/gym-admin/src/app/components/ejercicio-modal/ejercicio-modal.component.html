<div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm"
     *ngIf="isOpen()"
     (click)="onClose()">
  <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl transform transition-all duration-300 scale-100"
       (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-green-50 to-blue-50">
      <h2 class="text-2xl font-bold text-gray-800">{{ modalTitle() }}</h2>
      <button class="p-2 text-gray-600 hover:text-gray-800 hover:bg-white rounded-full transition-all duration-200 hover:scale-110"
              (click)="onClose()"
              title="Cerrar">
        ✕
      </button>
    </div>

    <!-- Content -->
    <div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)]">
      <form [formGroup]="ejercicioForm()" class="space-y-6">
        <!-- Nombre -->
        <div class="form-group">
          <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
            Nombre del Ejercicio *
          </label>
          <input
            id="nombre"
            type="text"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
            formControlName="nombre"
            placeholder="Nombre del ejercicio"
            [class.border-red-500]="ejercicioForm().get('nombre')?.invalid && ejercicioForm().get('nombre')?.touched"
          />
          @if (ejercicioForm().get('nombre')?.invalid && ejercicioForm().get('nombre')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              El nombre es obligatorio
            </p>
          }
        </div>

        <!-- Descripción -->
        <div class="form-group">
          <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-2">
            Descripción
          </label>
          <textarea
            id="descripcion"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 resize-none"
            formControlName="descripcion"
            placeholder="Descripción del ejercicio..."
            rows="3"
          ></textarea>
        </div>

        <!-- Series y Repeticiones -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-group">
            <label for="series" class="block text-sm font-medium text-gray-700 mb-2">
              Series *
            </label>
            <input
              id="series"
              type="number"
              min="1"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
              formControlName="series"
              [class.border-red-500]="ejercicioForm().get('series')?.invalid && ejercicioForm().get('series')?.touched"
            />
            @if (ejercicioForm().get('series')?.invalid && ejercicioForm().get('series')?.touched) {
              <p class="mt-1 text-sm text-red-600">
                Debe ser mayor a 0
              </p>
            }
          </div>

          <div class="form-group">
            <label for="repeticiones" class="block text-sm font-medium text-gray-700 mb-2">
              Repeticiones *
            </label>
            <input
              id="repeticiones"
              type="number"
              min="1"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
              formControlName="repeticiones"
              [class.border-red-500]="ejercicioForm().get('repeticiones')?.invalid && ejercicioForm().get('repeticiones')?.touched"
            />
            @if (ejercicioForm().get('repeticiones')?.invalid && ejercicioForm().get('repeticiones')?.touched) {
              <p class="mt-1 text-sm text-red-600">
                Debe ser mayor a 0
              </p>
            }
          </div>
        </div>

        <!-- Peso, Descanso y Serie -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="form-group">
            <label for="peso" class="block text-sm font-medium text-gray-700 mb-2">
              Peso (kg)
            </label>
            <input
              id="peso"
              type="number"
              min="0"
              step="0.5"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
              formControlName="peso"
              placeholder="0"
            />
          </div>

          <div class="form-group">
            <label for="descansoSegundos" class="block text-sm font-medium text-gray-700 mb-2">
              Descanso (segundos) *
            </label>
            <input
              id="descansoSegundos"
              type="number"
              min="0"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
              formControlName="descansoSegundos"
              [class.border-red-500]="ejercicioForm().get('descansoSegundos')?.invalid && ejercicioForm().get('descansoSegundos')?.touched"
            />
            @if (ejercicioForm().get('descansoSegundos')?.invalid && ejercicioForm().get('descansoSegundos')?.touched) {
              <p class="mt-1 text-sm text-red-600">
                Debe ser mayor o igual a 0
              </p>
            }
          </div>

          <div class="form-group">
            <label for="serieSegundos" class="block text-sm font-medium text-gray-700 mb-2">
              Serie (segundos)
            </label>
            <input
              id="serieSegundos"
              type="number"
              min="0"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
              formControlName="serieSegundos"
              placeholder="0"
            />
          </div>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <div class="flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50">
      <button
        type="button"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200"
        (click)="onClose()"
        [disabled]="isLoading()"
      >
        Cancelar
      </button>
      <button
        type="button"
        class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
        (click)="onSaveEjercicio()"
        [disabled]="isLoading() || ejercicioForm().invalid"
      >
        @if (isLoading()) {
          <span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></span>
          Guardando...
        } @else {
          {{ isCreating() ? 'Crear' : 'Actualizar' }}
        }
      </button>
    </div>
  </div>
</div>