<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Ejercicios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <!-- Lista de Ejercicios -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Mis Ejercicios</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          @for (ejercicio of ejerciciosCreados(); track ejercicio.id) {
            <ion-item button (click)="verEjercicio(ejercicio)">
              <ion-label>
                <h3>{{ ejercicio.nombre }}</h3>
                <p>{{ ejercicio.descripcion }}</p>
              </ion-label>
              <ion-button fill="clear" slot="end" color="primary" (click)="verEjercicio(ejercicio); $event.stopPropagation()">
                <ion-icon name="pencil"></ion-icon>
              </ion-button>
              <ion-button fill="clear" slot="end" color="danger" (click)="deleteEjercicio(ejercicio.id); $event.stopPropagation()">
                <ion-icon name="trash"></ion-icon>
              </ion-button>
            </ion-item>
          }
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Acciones -->
    <ion-card>
      <ion-card-content>
        <!-- Indicador de límite de plan -->
        <div style="margin-bottom: 16px; text-align: center;">
          <ion-text [color]="hasReachedEjercicioLimit() ? 'warning' : 'medium'" style="font-size: 0.9em;">
            <ion-icon name="information-circle-outline" style="margin-right: 4px;"></ion-icon>
            {{ ejercicioLimitMessage() }}
          </ion-text>
        </div>

        <ion-button 
          expand="block" 
          fill="solid" 
          color="primary" 
          (click)="crearEjercicio()"
          [disabled]="hasReachedEjercicioLimit()">
          <ion-icon name="barbell" slot="start"></ion-icon>
          Crear Nuevo Ejercicio
          @if (hasReachedEjercicioLimit()) {
            <ion-icon name="lock-closed" slot="end"></ion-icon>
          }
        </ion-button>

        @if (hasReachedEjercicioLimit()) {
          <ion-text color="warning" style="display: block; text-align: center; margin-top: 8px; font-size: 0.85em;">
            Has alcanzado el límite de tu plan. Actualiza para crear más ejercicios.
          </ion-text>
        }
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Modal para crear/editar ejercicio -->
  <ion-modal [isOpen]="isEjercicioModalOpen()" (willDismiss)="closeEjercicioModal()" [breakpoints]="[0, 0.9]" [initialBreakpoint]="0.9" [backdropDismiss]="true" class="ejercicio-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ isEjercicioCreating() ? 'Crear Ejercicio' : 'Editar Ejercicio' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEjercicioModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        @if (ejercicioEditForm()) {
          <form [formGroup]="ejercicioEditForm()!" (ngSubmit)="saveEjercicioChanges()">
          <ion-item>
            <ion-input
              label="Nombre"
              labelPlacement="stacked"
              formControlName="nombre"
              placeholder="Nombre del ejercicio"
            ></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-textarea
              label="Descripción"
              labelPlacement="stacked"
              formControlName="descripcion"
              placeholder="Descripción del ejercicio..."
              rows="3"
            ></ion-textarea>
          </ion-item>

          <ion-item>
            <ion-input
              label="Series"
              labelPlacement="stacked"
              type="number"
              formControlName="series"
              placeholder="Número de series"
            ></ion-input>
          </ion-item>

          <ion-item>
            <ion-input
              label="Repeticiones"
              labelPlacement="stacked"
              type="number"
              formControlName="repeticiones"
              placeholder="Repeticiones por serie"
            ></ion-input>
          </ion-item>

          <ion-item>
            <ion-input
              label="Peso (kg)"
              labelPlacement="stacked"
              type="number"
              step="0.5"
              formControlName="peso"
              placeholder="Peso en kilogramos"
            ></ion-input>
          </ion-item>

          <!-- Campos premium - solo visibles para planes pagos -->
          @if (!isFreePlan()) {
            <ion-item>
              <ion-input
                label="Duración de Serie (seg)"
                labelPlacement="stacked"
                type="number"
                formControlName="serieSegundos"
                placeholder="Duración por serie"
              ></ion-input>
            </ion-item>

            <ion-item>
              <ion-input
                label="Descanso (seg)"
                labelPlacement="stacked"
                type="number"
                formControlName="descansoSegundos"
                placeholder="Tiempo de descanso entre series"
              ></ion-input>
            </ion-item>
          } @else {
            <ion-item>
              <ion-text color="medium" style="font-size: 0.9em; padding: 8px 0;">
                <ion-icon name="star" style="margin-right: 4px;"></ion-icon>
                Los campos de duración y descanso están disponibles en planes premium.
              </ion-text>
            </ion-item>
          }

          <ion-button expand="block" type="submit" [disabled]="!ejercicioEditForm()?.valid">
            {{ isEjercicioCreating() ? 'Crear' : 'Guardar' }}
          </ion-button>
        </form>
        }
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>